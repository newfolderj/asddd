// SPDX-License-Identifier: BSD-3-Clause
// Copyright Â© 2023 TXA PTE. LTD.
pragma solidity ^0.8.19;

import "forge-std/Script.sol";
import "../src/Portal/Portal.sol";
import "../src/Staking/Staking.sol";
import "../src/Oracle/Oracle.sol";
import "../src/Rollup/Rollup.sol";
import "../src/Manager/ProcessingChain/ProcessingChainManager.sol";
import "@openzeppelin/contracts/token/ERC20/presets/ERC20PresetFixedSupply.sol";

contract ReportPrice is Script {
    using stdJson for string;

    function run() external {
        ProcessingChainManager manager = ProcessingChainManager(0x9D64eF9E402C11Df6f97cAf8A19fE6fA408732ff);
        Rollup rollup = Rollup(0xc47D0dA163e43217a6213584C61F8De7Bcb558fC);
        bytes[] memory txdata = new bytes[](4);
        txdata[0] =
            hex"3d5cb1b8047df824042c5e0ad568904af188f8d974ef4bc551071b119b6c79cd000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000003400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000001c2be1a3016299b82cb2e1e0f124685098e4b186ef3011e49cd1fb66f1436df98f2374b5e9bcd45fd0f54d7ae20b7c2122125b23f7cb0519ab351a646ce70614a500000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000131000000000000000000000000602ed35a5a5ed011cda22ea0d4b0b76305e01948000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a8899230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a889923000000000000000000000000000000000000000000000000000000000000004600000000000000000000000000000000000000000000000000000000000000890000000000000000000000000000000000000000000000000000000000000130000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a8899230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008900000000000000000000000000000000000000000000000340aad21b3b700000000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a8899230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009b5bcae21a87f48f432107dfed7510aca2652241995954c79fee6f104af6e3aeb6aeecae53759ef1723840d9e655dca391318229b7acdefcf72e92b3986bc381265c4e6702a6985cdc28e8cd4c5711020b4360540a9e7548c7ecbf8383d770f921369c0a2608c58abb8d2393761ed6c49b6aade08f01ecc4cc0a0c5c643f1da3f4162d784d835f12a9b9b2ae8b7f54700b3c9f5a8e227a0ccd4bf72023a1b4f8dc3ff63a85a67dc9f376c316bd07434fe96cc1600a728612bc16d17c9d9912709ec2f856a484cedbf9d6634416497cec02675555b613019cb19cdc3e477816c265824cf2bf05d897b5238df0341f4405a28f3231e4b6db962e793613ea3d2b4a51dc64a8e9e712e22ea2d1ac080d21c1e6268158c0dc44c51f48cb490e0cd5055";
        txdata[1] =
            hex"125448a9262bcb8026132a2cb5fb0451e59868b8b533f8c7d1e15e791b28a8e9000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000003400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000001b6dc9ff72656353960114a3e19a9bf02afa554f0f1f21ef5206c728fa7521db621f58bebfe6928fab99ac02e1b18e3fc624ff2006a62ff5022520dda08f26ba7100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000136000000000000000000000000602ed35a5a5ed011cda22ea0d4b0b76305e01948000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a8899230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a889923000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000135000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a88992300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000aa1acbc246c2219718f73af4dd98f02a9a88992300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000094f2e499ebeb62a7a08f5026c14b0a90a9396323286b05c78384fff50530e9da05b8e13b79edbcd2d520920610a39afe53061d88ccbf6b5a1bfe736dbc3fab3d7d5b2270c0f22d21934bf6b319687c354da5c6603ff3c00e239eaf914836569fb74f3c3a313c2bdb670b4608e0a07a4aeb5e1627d13fdd836d5871b7b7761659a3fb22a9971241656f493f0a404c2f2d92477c09277c6280ad438e8c7f9f5caf5ebd44430a82794abfc5d5acca364b2f5ab5f03cf9f2f4bb31ca0f9f6d429e86bf3ace1896f86f91627cc1c09eeaba2cd76d82a75be6f09b94c861524fa5e5289894376e04f932deadc9ab212ac514f37b41e670be2f8002babde1faf209354619ad4bf036c94cc9745f96ff80d55d935ce491d2ff3be797d7a25634285147737";
        txdata[2] =
            hex"5034ca2212f1196730cdb4136eedb5923fc9eb0a8fcd60f7c4405796e081112f000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000003400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000001c135a745d421ea1f016344f6ef29de4dea1510ef8ff880cdee4a03694fcfe3de80eaead57014ccad6fff94b707ce23194f3ad44b636b0d58f95ad71ef22f542a100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000158000000000000000000000000602ed35a5a5ed011cda22ea0d4b0b76305e01948000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000406cbaf8d64f47de3f27439f3e21802fbf6acb4b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000406cbaf8d64f47de3f27439f3e21802fbf6acb4b000000000000000000000000000000000000000000000000000000000000004900000000000000000000000000000000000000000000000000000000000000890000000000000000000000000000000000000000000000000000000000000119000000000000000000000000406cbaf8d64f47de3f27439f3e21802fbf6acb4b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008900000000000000000000000000000000000000000000000098944f7fa7084000000000000000000000000000406cbaf8d64f47de3f27439f3e21802fbf6acb4b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009ba00d8cc6cd2f7e926f2e9de95c52a0a84fc706911d6d9d6e248dfaf56d67c4e6e5874fbc27bd5654b49aec815febef727f8140f9f277da62206f7caeccb3f9dce996a56cf4bffb4c8047c15166c9b61b1d4ca36f930d6b0482a417ee3808074a04865dfc7366cf43f6636abcaaaad9b1e8ca5b048ed723ff3650f3f19be1fd2c1cf928fab15db3e11f835023c4d332607240219d607a345351807f8f9dcf4f9cff9410031d3168b1537691bb442b75253414f6ae9c90bdadcb67d9f53e63bc8750b0133855bca78c5321307c7805295b96fd54f0db83f19e3df1af68b3097fe95a321697627da04f79d47e11f4a263bd5a708bbf5093b392a211481ca6571785234b4a90a2ad8bfab153670d39b886213a298968ad55fc12c7cc0e57c2317e6";
        txdata[3] =
            hex"142daabdac58c33f218fee86eb372b230a82ecbedeaf5ac911e7ba08a2b0c9e6000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000003400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000001c54d035d1478118cb1e92d5b6365288ca07cf67c83d29dff9f3441aa5d73fd34e3eb87503c3157f602f0c906e226ac6acefa4f6b2da8fd4799e702af9751c330400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000209000000000000000000000000602ed35a5a5ed011cda22ea0d4b0b76305e01948000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000004e957143f5c9377767f05a8d03928a52a673dd5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000004e957143f5c9377767f05a8d03928a52a673dd5d0000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000008900000000000000000000000000000000000000000000000000000000000002080000000000000000000000004e957143f5c9377767f05a8d03928a52a673dd5d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000089000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000004e957143f5c9377767f05a8d03928a52a673dd5d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000890000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000af374b200cce55f07d71c90cc672e6cfc7f1ea6b7b630e7ff0276221a6d590c9bd390a106e02bb4d108bb9ea843a8ae87f355d8085efe0740a70a978ea4ceca19ed25791a05e5064a34b00cae0e51966202dc6ba9440a1f449bab4e7920e1d27318c4dfd4c74966890bfc8cb4bdfa82c88fa06d0ca27b0a241e1c66fa241aa5a5e9ba32393627d8484d99632c425b1de13c8397067471a2da5768339af0888f1e9c207a2e587241c7617104991ebac11d1546ee29eaa296cdcff932bd54c5b61118323cecf46735060680ce4e7abfae9cf1d0dfe1c70cf1283ba5417c90fd09bc1ec04a0805571e5834a8aebd624e7fdffe01f499bdfd0dcebc1e6c1156e848f364f93fbb36689e9fa22d33abdfdf75e8cbe22b098c1f376f8077c8875ee2bd321fafe6ffcdb6267ae7804dc008ff8a86b00c2317f8a6428b54e35ad09cbc3e84";

        vm.startBroadcast(vm.envUint("PRIVATE_KEY"));
        manager.grantValidator(vm.addr(vm.envUint("PRIVATE_KEY")));
        for (uint256 i = 0; i < 4; i++) {
            (bytes32 _stateRoot, StateUpdateLibrary.SignedStateUpdate memory _signedUpdate, bytes32[] memory _proof) =
                abi.decode(txdata[i], (bytes32, StateUpdateLibrary.SignedStateUpdate, bytes32[]));
            StateUpdateLibrary.Settlement memory settlement =
                abi.decode(_signedUpdate.stateUpdate.structData, (StateUpdateLibrary.Settlement));
            console.log(settlement.settlementRequest.trader);
            console.log(settlement.settlementRequest.asset);
            console.log(settlement.balanceBefore.amount);
            console.log(Id.unwrap(settlement.settlementRequest.chainId));
            rollup.submitSettlement{value: 0.05 ether}(_stateRoot, _signedUpdate, _proof);
        }
        manager.revokeValidator(vm.addr(vm.envUint("PRIVATE_KEY")));
        vm.stopBroadcast();
    }
}
